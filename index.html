<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Deploynow Docs by maateen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Deploynow Docs</h1>
      <h2 class="project-tagline">Push. Build. Deploy!</h2>
      <a href="https://github.com/maateen/deploynow" class="btn">View on GitHub</a>
      <a href="https://github.com/maateen/deploynow/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/maateen/deploynow/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h1>

<ul>
<li>
<a href="#start-deployment">Start Deployment</a>

<ul>
<li><a href="#creating-a-deployment-user">Creating a Deployment User</a></li>
<li><a href="#creating-deployment-path">Creating Deployment Path</a></li>
<li><a href="#adding-deploynow-public-key-to-your-server">Adding DeployNow Public Key to your Server</a></li>
<li><a href="#adding-your-deploy-key-to-githubgitlabbitbucket">Adding your Deploy Key to GitHub/GitLab/BitBucket</a></li>
<li><a href="#setting-up-git-in-your-deployment-path">Setting up Git in your Deployment Path</a></li>
</ul>
</li>
</ul>

<h1>
<a id="start-deployment" class="anchor" href="#start-deployment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start Deployment</h1>

<h2>
<a id="creating-a-deployment-user" class="anchor" href="#creating-a-deployment-user" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating a Deployment User</h2>

<p>Your can log in to your server as root. While it is possible to perform application deployments as root, we recommend that you take a slightly longer path and create a separate user with limited write-access to use in DeployNow. This will circumscribe destructive powers of a mistyped command and reduce the risks associated with accidentally exposing your credentials on the web. The following command will create a new user with login “deploynow" and no password set yet. This user will be added to group www-data as it is used in NginX. If you are using any Web Server except NginX, then change it as needed.</p>

<pre><code>useradd -U -G www-data -m -c "Used by DeployNow for deployment automation" deploynow
</code></pre>

<p>With NginX, the server is configured in a way that all web services are run by user www-data, a member of www-data group. Generally you’ll want your application files to be writable by your deployment user only, limiting www-data to read access except for when the write permissions are required (logging, file uploads, caching, etc).</p>

<h2>
<a id="creating-deployment-path" class="anchor" href="#creating-deployment-path" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating Deployment Path</h2>

<p>Now you need to pick up the directory where your web app files are going to be stored (for instance, /var/www/html). It has to be readable by the members of www-data group, but only writable by the deployment user.</p>

<pre><code>mkdir -p /var/www/html
</code></pre>

<pre><code>chown deploynow:www-data -R /var/www/html
</code></pre>

<pre><code>chmod 2755 /var/www/html
</code></pre>

<p>Note the 2755 access mode. It is recommended that you set the GUID bit on the application directory. This way all files created inside it will be automatically owned by group www-data (with read-only access).</p>

<h2>
<a id="adding-deploynow-public-key-to-your-server" class="anchor" href="#adding-deploynow-public-key-to-your-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding DeployNow Public Key to your Server</h2>

<p>Have you ever thought how DeployNow works? In simple, it login to your server with SSH and run necessary commands. So, to login via SSH key (without password). we need to have our public key on your server. You have to add our key manually. Here is our public key:</p>

<pre><code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCyaT6/9bjDBdVh9pKSsYEcHfimbiH83ikeSD9JiCHsvcxDecnFbHfsxlpVRNuqIuqRVrJtn5SOCwJk4K+t3UYQxJYQvbMbif57DfFyCQNQYo8y283cSHMTDf8HW/lBQe+NKNQC1zGkXAWuE0Q7k6C0P02WGYWVhbufIj1SNu3VTHZZtbjtscBgans3Z6n7TKt9Xd0k5kKQWY3MQctuJ9BXMezDQgm5Yl4gcQPZVJE3x5RCGbqbf8OJU3OXxpaAddj/xnR4xg4WVIfT7pJEyZE192a4A9u7/NGd0XN12bL6oJ7EDD6R3DK9wUYbw3yCSzaI44tH9aRHlNAoN5h0NUAnpnENFZV7HkgiNFB+2hQrJAbJgaJZzDOv/ZBulIB4Y3QvUNmxVZhtC52Eymdwcjexy5H8oJjlfL1XQHzb8Rbumtg6eQ3MEni3BzyvK7vDr4j8TPvX4/Fzfr/pE7nFmD6MbgiIW+b4Q24rG0k/gYBEWSaoVFiYwV7RqPM94mOZbhFjUGtQDUvcaQCL+7r+OqNqwjHs43UI8omEdvsQj9MqnV7lRc3iBmsK+3/Xjdg4H3eLzxdaiATpk77RV/1a3Q4GrfcxL9g5tX0IfaTuaKL3WkVvYx3j/XRCGJ/2gphTY4knlPVnvKt5RnYGhXBw971lqxc/Ht8z7byf5n1un/Yodw== maateen@outlook.com
</code></pre>

<p>Now, login to your server as root. Then play the following commands (never forget to change the <strong>deploynow</strong> to your deployment user):</p>

<pre><code>su deploynow
</code></pre>

<pre><code>mkdir ~/.ssh
</code></pre>

<pre><code>chmod 0700 ~/.ssh
</code></pre>

<pre><code>nano ~/.ssh/authorized_keys
</code></pre>

<p>Here you will see a file to be opened. Paste our public key here. Press <strong>Ctrl + X</strong>, then press <strong>Y</strong> and at last press <strong>Enter</strong>.</p>

<h2>
<a id="adding-your-deploy-key-to-githubgitlabbitbucket" class="anchor" href="#adding-your-deploy-key-to-githubgitlabbitbucket" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding your Deploy Key to GitHub/GitLab/BitBucket</h2>

<p>You need to generate a deploy key and should add it to your repository for the deployment process. Let's generate it. Open Terminal. Paste the text below, substituting in your GitHub/GitLab/BitBucket email address.:</p>

<pre><code>ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
</code></pre>

<p>When you're prompted to "Enter a file in which to save the key," press Enter. This accepts the default file location. After that, you will be asked to type a passphrase. Don't type anything, just press <strong>Enter</strong> twice. Now play the following command:</p>

<pre><code>cat /home/deploynow/.ssh/id_rsa.pub
</code></pre>

<p>This will show your deploy key. Simply add this to the desired repository.</p>

<p>Now login to your server and play the following commands (never forget to change the <strong>deploynow</strong> to your deployment user):</p>

<pre><code>su deploynow
</code></pre>

<pre><code>nano ~/.bashrc
</code></pre>

<p>A file will be opened. At the end of the file, add these lines:</p>

<div class="highlight highlight-source-shell"><pre><span class="pl-k">if</span> [ <span class="pl-k">!</span> <span class="pl-k">-S</span> <span class="pl-k">~</span>/.ssh/ssh_auth_sock ]<span class="pl-k">;</span> <span class="pl-k">then</span>
  <span class="pl-c1">eval</span> <span class="pl-s"><span class="pl-pds">`</span>ssh-agent<span class="pl-pds">`</span></span>
  ln -sf <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$SSH_AUTH_SOCK</span><span class="pl-pds">"</span></span> <span class="pl-k">~</span>/.ssh/ssh_auth_sock
<span class="pl-k">fi</span>
<span class="pl-k">export</span> SSH_AUTH_SOCK=<span class="pl-k">~</span>/.ssh/ssh_auth_sock
ssh-add -l <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>The agent has no identities<span class="pl-pds">"</span></span> <span class="pl-k">&amp;&amp;</span> ssh-add</pre></div>

<p>Press <strong>Ctrl + X</strong>, then press <strong>Y</strong> and at last press <strong>Enter</strong>.</p>

<h2>
<a id="setting-up-git-in-your-deployment-path" class="anchor" href="#setting-up-git-in-your-deployment-path" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting up Git in your Deployment Path</h2>

<p>Now login to your server and play the following commands (never forget to change the <strong>deploynow</strong> to your deployment user):</p>

<pre><code>su deploynow
</code></pre>

<p>You should install git as our bot will use it. Then initialize git in your deployment path:</p>

<pre><code>git init
</code></pre>

<pre><code>git remote add origin [SSH URL of the repository]
</code></pre>

<pre><code>git pull origin [branch]
</code></pre>

<p>That's all. We will do the continuous integration from then.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/maateen/deploynow">Deploynow Docs</a> is maintained by <a href="https://github.com/maateen">maateen</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
